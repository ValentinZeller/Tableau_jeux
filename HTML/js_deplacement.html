
<!DOCTYPE html>
<html>
  <!-- En-tête spécification -->
  <head>
    <!-- Gestion des caractères -->
    <meta charset="utf-8">
    <!-- Titre de la page -->
    <title>Déplacement</title>
    <!-- Icone onglet  -->
    <link rel="shortcut icon" type="image/x-icon" href="../contenu/images/zenyatta.png"/>
    <!-- Appel du css depuis un fichier externe-->
    <link rel="stylesheet" href="../CSS/style.css" type="text/css" />
    <script type="text/javascript" src="../JS/script.js"></script>
    <style>
        #cadre {
            border: 10px solid black;
            width: 90px;
            height: 90px;
            background-color:darkorange;
        }

        #par1 {
            font-style: italic;
        }

        .test {
            color:blue;
        }

        .container {
            width:400px;
            height:400px;
            background-color: darkslateblue;
            position: relative;
        }
        .anime {
            width: 50px;
            height: 50px;
            background-color: lightcoral;
            position: absolute;
        }

        #anime2 {
            top: 60px;
            background-color: lightgreen;
        }
    </style>
  </head>
  
  <body>
    <h2>DOM : Document Object Model</h2>
    <h2>Déplacement en DOM</h2>
    <p>Utiliser les flèches et ZQSD pour déplacer les blocks.</p>
    <div id="container" class="container">
        <div id="anime" class="anime"></div>
        <div id="anime2" class="anime"></div>
    </div>  
    <script>
        anime = document.getElementById("anime"); //Block déplaçable
        anime2 = document.getElementById("anime2"); //Block déplaçable
        container = document.getElementById("container"); //Zone où se trouve les blocks

        let keysPressed = []; //Gestion des inputs
        const speed = 1;
        const size = 50;

        animePos = {x:0,y:0,w:size,h:size}; //Collision box
        anime2Pos = {x:0,y:60,w:size,h:size}; //Collision box
        zone = {w:container.offsetWidth,h:container.offsetHeight} //Taille max de la zone
        var inter;

        function keyDownHandler(event) {
            //Pression sur une touche
            //event.preventDefault();
            keysPressed[event.code] = true;
            if (inter) {
                
            } else {
                inter = setInterval(manage,1);
            }
        }

        function keyUpHandler(event) {
            //Touche relachée
            keysPressed[event.code] = false;
        }

        function manage() {
            //Gestion des touches pour déplacer les blocks
            if (keysPressed["ArrowDown"]) {
                moveTop(speed,anime,animePos,anime2Pos);
            }
            if (keysPressed["ArrowUp"]) {
                moveTop(-speed,anime,animePos,anime2Pos);
            }
            if (keysPressed["ArrowLeft"]) {
                moveLeft(-speed,anime,animePos,anime2Pos);
            }
            if (keysPressed["ArrowRight"]) {
                moveLeft(speed,anime,animePos,anime2Pos);
            }

            if (keysPressed["KeyS"]) {
                moveTop(speed,anime2,anime2Pos,animePos);
            }
            if (keysPressed["KeyW"]) {
                moveTop(-speed,anime2,anime2Pos,animePos);
            }
            if (keysPressed["KeyA"]) {
                moveLeft(-speed,anime2,anime2Pos,animePos);
            }
            if (keysPressed["KeyD"]) {
                moveLeft(speed,anime2,anime2Pos,animePos);
            }
            renderBlock();
        }

        

        function collision(blockPos,blockCol,top,left) {
            //Gestion des collisions entre deux blocks
            //BlockPos : le block déplacé
            //BlockCol : block qui peut être en collision
            //top : déplacement haut-bas
            //left : déplacement gauche-droite
            side = "none";
            result = true;
            if ((blockPos.x + left < blockCol.x + blockCol.w )&&(blockPos.x + blockPos.w + left > blockCol.x)&&(blockPos.y + top < blockCol.y + blockCol.h)&&(blockPos.y + blockCol.h + top > blockCol.y)) {
                result = false;
                /* Trouve le coté en collision pour le rebond */
                if (blockPos.x + left > blockCol.x + blockCol.w) {
                    side = "left";
                }
                else if (blockPos.x + blockPos.w + left > blockCol.x) {
                    side = "right";
                }
                else if (blockPos.y + top < blockCol.y + blockCol.h) {
                    side = "top";
                }
                else if (blockPos.y + blockCol.h + top > blockCol.y) {
                    side = "bottom";
                }
                
            }
            return [result,side]; 
            //result = booleen pour savoir si collision ou non
            //side = string pour savoir le cote en collision
        }

        function moveTop(top,block,blockPos,blockCol) {
            //Mouvement haut-bas
            col = collision(blockPos,blockCol,top,0);
            if (!(blockPos.y + blockPos.h + top > zone.h || blockPos.y + top < 0)&&col[0]) {
                blockPos.y += top;
                //block.style.top = blockPos.y+"px";
            }
            /* Rebond 
            else if (!col[0]) {
                switch (col[1]) {
                    case 'top':
                        blockPos.y += top;
                        break;
                    case 'bottom' :
                        blockPos.y -= top;
                        break;
                }
            }
            */
        }
        function moveLeft(left,block,blockPos,blockCol) {
            //Mouvement gauche-droite
            col = collision(blockPos,blockCol,0,left);
            if (!(blockPos.x + blockPos.w + left > zone.w || blockPos.x + left < 0)&&col[0]) {
                blockPos.x += left;
                //block.style.left = blockPos.x+"px";
            }
            /* Rebond
            else if (!col[0]) {
                switch (col[1]) {
                    case 'left':
                        blockPos.x += left;
                        break;
                    case 'right' :
                        blockPos.x -= left;
                        break;
                }
            }
            */
        }
        document.addEventListener("keydown", keyDownHandler, false);
        document.addEventListener("keyup", keyUpHandler, false);

        function renderBlock() {
            //Affichage des blocks
            anime.style.top = animePos.y+"px";
            anime.style.left = animePos.x+"px";
            anime2.style.top = anime2Pos.y+"px";
            anime2.style.left = anime2Pos.x+"px";
        }
    </script>


    <!-- Pied de page -->
    <footer>
    <h3>Contact :</h3>
    <ul>
        <li><a href="mailto:v.zeller@ludus-academie.com" title="Mail">Me contacter par mail</a></li>
        <li>06.18.93.91.06</li>
    </ul>
    </footer>
</body>
</html>